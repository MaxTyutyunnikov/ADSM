

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ru" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ru" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Способы работы с RESTful API &mdash; Документация ADSM 0.1.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="next" title="Критика RESTful API и альтернативы" href="other.html" />
    <link rel="prev" title="Методы" href="methods.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../contents.html" class="icon icon-home"> ADSM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../0_planning/planning.html">Часть 0. Планирование</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../1_virtualization/index.html">Часть 1. Виртуализация</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../2_network_design/index.html">Часть 2. Дизайн сети</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Часть 3. IPAM/DCIM-системы</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">RESTful API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rest.html">REST, RESTful, API</a></li>
<li class="toctree-l3"><a class="reference internal" href="messages.html">Структура сообщений HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="methods.html">Методы</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Способы работы с RESTful API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#postman">Postman</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python-requests">Python+requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python-netbox-sdk">Python+NetBox SDK</a></li>
<li class="toctree-l4"><a class="reference internal" href="#swagger">SWAGGER</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="other.html">Критика RESTful API и альтернативы</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">ADSM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Часть 3. IPAM/DCIM-системы</a> &raquo;</li>
        
          <li><a href="index.html">RESTful API</a> &raquo;</li>
        
      <li>Способы работы с RESTful API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/3_ipam_dcim/restful/ways.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="restful-api">
<h1>Способы работы с RESTful API<a class="headerlink" href="#restful-api" title="Ссылка на этот заголовок">¶</a></h1>
<p>Curl - это, конечно, очень удобно для доблестных воинов CLI, но есть инструменты получше:
* Графическая утилита Postman
* Библиотека requests в Python
* Python SDK для NetBox Pynetbox
* API-фреймворк Swagger</p>
<div class="section" id="postman">
<h2>Postman<a class="headerlink" href="#postman" title="Ссылка на этот заголовок">¶</a></h2>
<p>Postman позволяет в графическом интерфейсе формировать запросы, выбирая методы, заголовки, тело, и отображает результат в удобочитаемом виде.
Кроме того запросы и URI можно сохранять и возвращаться к ним позже.</p>
<p><a class="reference external" href="https://www.getpostman.com/downloads/">Скачать Postman на оф.сайте</a>.</p>
<p>Так мы можем сделать GET:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/postman_get.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/postman_get.png" src="https://fs.linkmeup.ru/images/adsm/3/postman_get.png" style="width: 800px;" /></a>
</div>
</div></blockquote>
<p><em>Здесь указан Token в GET только для примера.</em></p>
<p>А так POST:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/postman_post.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/postman_post.png" src="https://fs.linkmeup.ru/images/adsm/3/postman_post.png" style="width: 800px;" /></a>
</div>
</div></blockquote>
<p>Postman служит только для работы с RESTful API.</p>
<blockquote>
<div>Например, не пытайтесь через него отправить NETCONF XML, как это делал я на заре своей автоматизационной карьеры.</div></blockquote>
<p>Один из приятных бонусов специфицированного API в том, что вы можете в Postman импортировать все эндпоинты и их методы как коллекцию.
Для этого в окне <strong>Import</strong> (File-&gt;Import) выберите <strong>Import From Link</strong> и вставьте в окно URL <a class="reference external" href="http://netbox.linkmeup.ru:45127/api/docs/?format=openapi">http://netbox.linkmeup.ru:45127/api/docs/?format=openapi</a>.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/postman_import.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/postman_import.png" src="https://fs.linkmeup.ru/images/adsm/3/postman_import.png" style="width: 400px;" /></a>
</div>
</div></blockquote>
<p>Далее, всё, что только можно, вы найдёте в коллекциях.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/postman_collections.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/postman_collections.png" src="https://fs.linkmeup.ru/images/adsm/3/postman_collections.png" style="width: 200px;" /></a>
</div>
</div></blockquote>
</div>
<div class="section" id="python-requests">
<h2>Python+requests<a class="headerlink" href="#python-requests" title="Ссылка на этот заголовок">¶</a></h2>
<p>Но даже через Postman вы, скорее всего, не будете управлять своими Production-системами. Наверняка, у вас будут внешние приложения, которые захотят без вашего участия взаимодействовать с ними.
Например, система генерации конфигурации захочет забрать список IP-интерфейсов из NetBox.
В Python есть чудесная библиотека <strong>requests</strong>, которая реализует работу через HTTP.
Пример запроса списка всех устройств:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import requests

<span class="nv">HEADERS</span> <span class="o">=</span> <span class="o">{</span><span class="s1">&#39;Content-Type&#39;</span>: <span class="s1">&#39;application/json&#39;</span>, <span class="s1">&#39;Accept&#39;</span>: <span class="s1">&#39;application/json&#39;</span><span class="o">}</span>
<span class="nv">NB_URL</span> <span class="o">=</span> <span class="s2">&quot;http://netbox.linkmeup.ru:45127&quot;</span>

<span class="nv">request_url</span> <span class="o">=</span> f<span class="s2">&quot;{NB_URL}/api/dcim/devices/&quot;</span>
<span class="nv">devices</span> <span class="o">=</span> requests.get<span class="o">(</span>request_url, <span class="nv">headers</span> <span class="o">=</span> HEADERS<span class="o">)</span>
print<span class="o">(</span>devices.json<span class="o">())</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference external" href="https://github.com/eucariot/ADSM/blob/master/docs/source/3_ipam/scripts/requests_get_devices.py">Код скрипта на github</a>.</p>
<p>Снова добавим новое устройство:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import requests

<span class="nv">API_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;a9aae70d65c928a554f9a038b9d4703a1583594f&quot;</span>
<span class="nv">HEADERS</span> <span class="o">=</span> <span class="o">{</span><span class="s1">&#39;Authorization&#39;</span>: f<span class="s1">&#39;Token {API_TOKEN}&#39;</span>, <span class="s1">&#39;Content-Type&#39;</span>: <span class="s1">&#39;application/json&#39;</span>, <span class="s1">&#39;Accept&#39;</span>: <span class="s1">&#39;application/json&#39;</span><span class="o">}</span>
<span class="nv">NB_URL</span> <span class="o">=</span> <span class="s2">&quot;http://netbox.linkmeup.ru:45127&quot;</span>

<span class="nv">request_url</span> <span class="o">=</span> f<span class="s2">&quot;{NB_URL}/api/dcim/devices/&quot;</span>

<span class="nv">device_parameters</span> <span class="o">=</span> <span class="o">{</span>
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;just a simple REQUESTS girl&quot;</span>,
    <span class="s2">&quot;device_type&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;device_role&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;site&quot;</span>: <span class="m">3</span>,
<span class="o">}</span>
<span class="nv">new_device</span> <span class="o">=</span> requests.post<span class="o">(</span>request_url, <span class="nv">headers</span> <span class="o">=</span> HEADERS, <span class="nv">json</span><span class="o">=</span>device_parameters<span class="o">)</span>
print<span class="o">(</span>new_device.json<span class="o">())</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference external" href="https://github.com/eucariot/ADSM/blob/master/docs/source/3_ipam/scripts/requests_post_new_device.py">Код скрипта на github</a>.</p>
</div>
<div class="section" id="python-netbox-sdk">
<h2>Python+NetBox SDK<a class="headerlink" href="#python-netbox-sdk" title="Ссылка на этот заголовок">¶</a></h2>
<p>В случае NetBox есть также Python SDK - <a class="reference external" href="https://github.com/digitalocean/pynetbox">Pynetbox</a>, который представляет все Endpoint’ы NetBox в виде объекта и его атрибутов, делая за вас всю грязную работу по формированию URI и парсингу ответа, хотя и не бесплатно, конечно.</p>
<p>Например, сделаем то же, что и выше, использую pynetbox.
Список всех устройств:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import pynetbox

<span class="nv">NB_URL</span> <span class="o">=</span> <span class="s2">&quot;http://netbox.linkmeup.ru:45127&quot;</span>
<span class="nv">nb</span> <span class="o">=</span> pynetbox.api<span class="o">(</span>NB_URL<span class="o">)</span>

<span class="nv">devices</span> <span class="o">=</span> nb.dcim.devices.all<span class="o">()</span>
print<span class="o">(</span>devices<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference external" href="https://github.com/eucariot/ADSM/blob/master/docs/source/3_ipam/scripts/pynetbox_get_devices.py">Кот скрипта на github</a>.</p>
<p>Добавить новое устройство:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import pynetbox

<span class="nv">API_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;a9aae70d65c928a554f9a038b9d4703a1583594f&quot;</span>
<span class="nv">NB_URL</span> <span class="o">=</span> <span class="s2">&quot;http://netbox.linkmeup.ru:45127&quot;</span>
<span class="nv">nb</span> <span class="o">=</span> pynetbox.api<span class="o">(</span>NB_URL, <span class="nv">token</span> <span class="o">=</span> API_TOKEN<span class="o">)</span>

<span class="nv">device_parameters</span> <span class="o">=</span> <span class="o">{</span>
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;just a simple PYNETBOX girl&quot;</span>,
    <span class="s2">&quot;device_type&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;device_role&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;site&quot;</span>: <span class="m">3</span>,
<span class="o">}</span>
<span class="nv">new_device</span> <span class="o">=</span> nb.dcim.devices.create<span class="o">(</span>**device_parameters<span class="o">)</span>
print<span class="o">(</span>new_device<span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p><a class="reference external" href="https://github.com/eucariot/ADSM/blob/master/docs/source/3_ipam/scripts/requests_post_new_device.py">Скот скрипта на github</a>.</p>
<p><a class="reference external" href="https://pynetbox.readthedocs.io/en/latest/">Документация по Pynetbox</a>.</p>
</div>
<div class="section" id="swagger">
<h2>SWAGGER<a class="headerlink" href="#swagger" title="Ссылка на этот заголовок">¶</a></h2>
<p>За что ещё стоит поблагодарить ушедшее десятилетие, так это за спецификации API. Если вы перейдёте по <a class="reference external" href="http://netbox.linkmeup.ru:45127/api/docs/">этому пути</a>, то попадёте в Swagger UI - документацию по API Netbox.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/swagger.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/swagger.png" src="https://fs.linkmeup.ru/images/adsm/3/swagger.png" style="width: 800px;" /></a>
</div>
</div></blockquote>
<p>На этой странице перечислены все Endpoint’ы, методы работы с ними, возможные параметры и атрибуты и указано, какие из них обязательны. Кроме того описаны ожидаемые ответы.</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/swagger_endpoints_and_methods.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/swagger_endpoints_and_methods.png" src="https://fs.linkmeup.ru/images/adsm/3/swagger_endpoints_and_methods.png" style="width: 800px;" /></a>
</div>
</div></blockquote>
<p>На этой же странице можно выполнять интерактивные запросы, кликнув на <strong>Try it out</strong>.</p>
<p>По какой-от причине swagger в качестве Base URL берёт имя сервера без порта, поэтому функция Try it out не работает в моих примерах со Swagger’ом. Но вы можете попробовать это на собственной инсталляции.</p>
<p>При нажатии на <strong>Execute</strong> Swagger UI сформирует строку curl, с помощью которой можно аналогичный запрос сделать из командной строки.</p>
<p>В Swagger UI можно даже создать объект:</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="https://fs.linkmeup.ru/images/adsm/3/swagger_post.png"><img alt="https://fs.linkmeup.ru/images/adsm/3/swagger_post.png" src="https://fs.linkmeup.ru/images/adsm/3/swagger_post.png" style="width: 800px;" /></a>
</div>
</div></blockquote>
<p>Для этого достаточно быть авторизованным пользователем, обладающим нужными правами.</p>
<p>То, что мы видим на этой странице - это Swagger UI - документация, сгенерированная на основе спецификации API.</p>
<p>С трендами на микросервисную архитектуру всё более важным становится иметь стандартизированный API для взаимодействия между компонентами, эндпоинты и методы которого легко определить как человеку, так и приложению, не роясь в исходном коде или PDF-документации.
Поэтому разработчики сегодня всё чаще следуют парадигме <a class="reference external" href="https://medium.com/adobetech/three-principles-of-api-first-design-fa6666d9f694">API First</a>, когда сначала задумываются об API, а уже потом о реализации.
В этом дизайне сначала специфицируется API, а затем из него <strong>генерируются</strong> документация, клиентское приложение, серверная часть и необходимы тесты.</p>
<p>Swagger - это фреймворк и язык спецификации (который ныне переименован в OpenAPI 2.0), позволяющие реализовать эту задачу.
Углубляться в него я не буду.
За бо́льшими деталями сюда:
* <a class="reference external" href="https://swagger.io/docs/specification/">Сайт Swagger</a>
* <a class="reference external" href="https://justcodeit.ru/swagger-docs-dlya-api-na-laravel/">Пример использования</a>
* <a class="reference external" href="https://en.wikipedia.org/wiki/OpenAPI_Specification">Wiki про Open API</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="other.html" class="btn btn-neutral float-right" title="Критика RESTful API и альтернативы" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="methods.html" class="btn btn-neutral float-left" title="Методы" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, eucariot

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>