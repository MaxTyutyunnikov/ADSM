
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>&lt;no title&gt; &#8212; документация ADSM 0.1.0</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="prev" title="0. Цели" href="index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>Сейчас мы поставим максимально абстрактные цели:
&lt;ul&gt;</p>
<blockquote>
<div><p>&lt;li&gt;Сеть - как единый организм&lt;/li&gt;
&lt;li&gt;Тестирование конфигурации&lt;/li&gt;
&lt;li&gt;Версионирование состояния сети&lt;/li&gt;
&lt;li&gt;Мониторинг и самовосстановление сервисов&lt;/li&gt;</p>
</div></blockquote>
<p>&lt;/ul&gt;
Позже в этой статье разберём какие будем использовать средства, а в следующих и цели и средства в подробностях.</p>
<p>&lt;a name=»SAVE»&gt;&lt;/a&gt;
&lt;h2&gt;Сеть - как единый организм&lt;/h2&gt;
Определяющая фраза цикла, хотя на первый взгляд она может показаться не такой уж значительной: &lt;b&gt;мы будем настраивать сеть, а не отдельные устройства&lt;/b&gt;.
Все последние годы мы наблюдаем сдвиг акцентов к тому, чтобы обращаться с сетью, как с единой сущностью, отсюда и приходящие в нашу жизнь &lt;i&gt;Software Defined Networking&lt;/i&gt;, &lt;i&gt;Intent Driven Networks&lt;/i&gt; и &lt;i&gt;Autonomous Networks&lt;/i&gt;.
Ведь что глобально нужно приложениям от сети: связности между точками А и Б (ну иногда +В-Я) и изоляции от других приложений и пользователей.</p>
<p>&lt;img src=»<a class="reference external" href="https://fs.linkmeup.ru/images/adsm/0/seteviki-ne-nuzhny.jpg">https://fs.linkmeup.ru/images/adsm/0/seteviki-ne-nuzhny.jpg</a>» width=»400»&gt;</p>
<p>И таким образом, наша задача в этой серии - &lt;b&gt;выстроить систему&lt;/b&gt;,  поддерживающую актуальную конфигурацию &lt;b&gt;всей сети&lt;/b&gt;, которая уже декомпозируется на актуальную конфигурацию на каждом устройстве в соответствии с его ролью и местоположением.
&lt;b&gt;Система&lt;/b&gt; управления сетью подразумевает, что для внесения изменений мы обращаемся в неё, а она уже в свою очередь вычисляет нужное состояние для каждого устройства и настраивает его.
Таким образом мы минимизируем почти до нуля хождение в CLI руками - любые изменения в настройках устройств или дизайне сети должны быть формализованы и документированы - и только потом выкатываться на нужные элементы сети.</p>
<dl>
<dt>&lt;blockquote&gt;</dt><dd><p>То есть, например, если мы решили, что с этого момента стоечные коммутаторы в Казани должны анонсировать две сети вместо одной, мы
&lt;ol&gt;</p>
<blockquote>
<div><p>&lt;li&gt;Сначала документируем изменения в системах&lt;/li&gt;
&lt;li&gt;Генерируем целевую конфигурацию всех устройств сети&lt;/li&gt;
&lt;li&gt;Запускаем программу обновления конфигурации сети, которая вычисляет, что нужно удалить на каждом узле, что добавить, и приводит узлы к нужному состоянию.&lt;/li&gt;</p>
</div></blockquote>
<p>&lt;/ol&gt;</p>
<p>При этом руками мы вносим изменения только на первом шаге.</p>
</dd>
</dl>
<p>&lt;/blockquote&gt;</p>
<p>&lt;a name=»US»&gt;&lt;/a&gt;
&lt;h2&gt;Тестирование конфигурации&lt;/h2&gt;
&lt;a href=»<a class="reference external" href="http://www.wikisummaries.org/wiki/Visible_Ops">http://www.wikisummaries.org/wiki/Visible_Ops</a>» target=»blank»&gt;Известно&lt;/a&gt;, что 80% проблем случаются во время изменения конфигурации - косвенное тому свидетельство - то, что в период новогодних каникул обычно всё спокойно.
Я лично был свидетелем десятков глобальных даунтаймов из-за ошибки человека: неправильная команда, не в той ветке конфигурации выполнили, забыли комьюнити, снесли MPLS глобально на маршрутизаторе, настроили пять железок, а на шестой ошибку не заметили, закоммитили старые изменения, сделанные другим человеком. Сценариев тьма тьмущая.</p>
<p>Автоматика нам позволит совершать меньше ошибок, но в большем масштабе. Так можно окирпичить не одно устройство, а всю сеть разом.</p>
<p>Испокон веков наши деды проверяли правильность вносимых изменений острым глазом, стальными яйцами и работоспособностью сети после их выкатки.
Те деды, чьи работы приводили к простою и катастрофическим убыткам, оставляли меньше потомства и должны со временем вымереть, но эволюция процесс медленный, и поэтому до сих пор не все предварительно проверяют изменения в лаборатории.
Однако на острие прогресса те, кто автоматизировал процесс тестирования конфигурации, и дальнейшего её применения на сеть. Иными словами - позаимствовал процедуру CI/CD (&lt;a href=»<a class="reference external" href="https://img.devrant.com/devrant/rant/r_1535091_ErSUL.jpg">https://img.devrant.com/devrant/rant/r_1535091_ErSUL.jpg</a>»&gt;Continuous Integration, Continuous Deployment&lt;/a&gt;) у разработчиков.
В одной из частей мы рассмотрим как реализовать это с помощью системы контроля версий, вероятно, гитхаба.</p>
<dl class="simple">
<dt>&lt;blockquote&gt;</dt><dd><p>Как только вы свыкнитесь с мыслью о сетевом CI/CD, в одночасье метод проверки конфигурации путём её применения на рабочую сеть покажется вам раннесредневековым невежеством. Примерно как стучать молотком по боеголовке.</p>
</dd>
</dl>
<p>&lt;/blockquote&gt;</p>
<p>Органическим продолжением идей о &lt;b&gt;системе&lt;/b&gt; управления сетью и CI/CD становится полноценное версионирование конфигурации.</p>
<p>&lt;a name=»FROM»&gt;&lt;/a&gt;
&lt;h2&gt;Версионирование&lt;/h2&gt;
Мы будем считать, что при любых изменениях, даже самых незначительных, даже на одном незаметном устройстве, вся сеть переходит из одного состояния в другое.
И мы всегда не выполняем команду на устройстве, мы меняем состояние сети.
Вот давайте эти состояния и будем называть версиями?</p>
<p>Допустим, текущая версия - 1.0.0.
Поменялся IP-адрес Loopback-интерфейса на одном из ToR’ов? Это минорная версия - получит номер 1.0.1.
Пересмотрели политики импорта маршрутов в BGP - чуть посерьёзнее - уже 1.1.0
Решили избавиться от IGP и перейти только на BGP - это уже радикальное изменение дизайна - 2.0.0.</p>
<p>При этом разные ДЦ могут иметь разные версии - сеть развивается, ставится новое оборудование, где-то добавляются новые уровни спайнов, где-то - нет, итд.</p>
<p>Про &lt;a href=»<a class="reference external" href="https://semver.org">https://semver.org</a>»&gt;семантическое версионирование&lt;/a&gt; мы поговорим в отдельной статье.</p>
<p>Повторюсь - любое изменение (кроме отладочных команд) - это обновление версии. О любых отклонениях от актуальной версии должны оповещаться администраторы.</p>
<p>То же самое касается отката изменений - это не отмена последних команд, это не rollback силами операционной системы устройства - это приведение всей сети к новой (старой) версии.</p>
<p>&lt;a name=»PYTHON»&gt;&lt;/a&gt;
&lt;h2&gt;Мониторинг и самовосстановление сервисов&lt;/h2&gt;
Это самоочевидная задача в современных сетях выходит на новый уровень.
Зачастую у больших сервис-провайдеров практикуется подход, что упавший сервис надо очень быстро добить и поднять новый, вместо того, чтобы разбираться, что произошло.
«Очень» означает, что со всех сторон нужно обильно обмазаться мониторингами, которые в течение секунд обнаружат малейшие отклонения  от нормы.
И здесь уже не достаточно привычных метрик, вроде загрузки интерфейса или доступности узла. Недостаточно и ручного слежения дежурного за ними.
Для многих вещей вообще должен быть &lt;a href=»<a class="reference external" href="https://www.irisns.com/self-healing-network-tomorrow-look-like/">https://www.irisns.com/self-healing-network-tomorrow-look-like/</a>»&gt;Self-Healing&lt;/a&gt; - мониторинги зажглись красным и пошли сами подорожник приложили, где болит.</p>
<p>И здесь мы тоже мониторим не только отдельные устройства, но и здоровье сети целиком, причём как вайтбокс, что сравнительно понятно, так и блэкбокс, что уже сложнее.</p>
<p>&lt;hr&gt;</p>
<p>Что нам понадобится для реализации таких амбициозных планов?
&lt;ul&gt;</p>
<blockquote>
<div><p>&lt;li&gt;Иметь список всех устройств в сети, их расположение, роли, модели, версии ПО.
&lt;i&gt;kazan-leaf-1.lmu.net, Kazan, leaf, Juniper QFX 5120, R18.3.&lt;/i&gt;
&lt;/li&gt;
&lt;li&gt;Иметь систему описания сетевых сервисов.
&lt;i&gt;IGP, BGP, L2/3VPN, Policy, ACL, NTP, SSH.&lt;/i&gt;&lt;/li&gt;
&lt;li&gt;Уметь инициализировать устройство.
&lt;i&gt;Hostname, Mgmt IP, Mgmt Route, Users, RSA-Keys, LLDP, NETCONF&lt;/i&gt;&lt;/li&gt;
&lt;li&gt;Настраивать устройство и приводить конфигурацию к нужной (в том числе старой) версии.&lt;/li&gt;
&lt;li&gt;Тестировать конфигурацию&lt;/li&gt;
&lt;li&gt;Периодически проверять состояние всех устройств на предмет отхождения от актуального и сообщать кому следует.
ночью кто-то тихонько добавил правило в ACL&lt;/li&gt;
&lt;li&gt;Следить за работоспособностью.&lt;/li&gt;</p>
</div></blockquote>
<p>&lt;/ul&gt;
&lt;hr&gt;</p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ADSM</a></h1>








<h3>Навигация</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to ADSM’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#indices-and-tables">Indices and tables</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Welcome to ADSM’s documentation!</a><ul>
  <li><a href="index.html">0. Цели</a><ul>
      <li>Previous: <a href="index.html" title="предыдущая глава">0. Цели</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Искать" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, eucariot.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/0_planning/0_goals/goals.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>