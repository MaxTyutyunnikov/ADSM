
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>0.ЦЕЛИ &#8212; документация ADSM 0.1.0</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="prev" title="0. Цели" href="index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>0.ЦЕЛИ<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h1>
<p>Сейчас мы поставим максимально абстрактные цели:</p>
<ul>
    <li><p>Сеть - как единый организм</p>
</li>
    <li><p>Тестирование конфигурации</p>
</li>
    <li><p>Версионирование состояния сети</p>
</li>
    <li><p>Мониторинг и самовосстановление сервисов</p>
</li>
</ul><p>Позже в этой статье разберём какие будем использовать средства, а в
следующих и цели и средства в подробностях.</p>
<h2><p>Сеть - как единый организм</p>
</h2><div class="line-block">
<div class="line">Определяющая фраза цикла, хотя на первый взгляд она может показаться</div>
</div>
<p>не такой уж значительной: мы будем настраивать сеть, а не отдельные
устройства.
| Все последние годы мы наблюдаем сдвиг акцентов к тому, чтобы
обращаться с сетью, как с единой сущностью, отсюда и приходящие в нашу
жизнь Software Defined Networking, Intent Driven Networks и Autonomous
Networks.
| Ведь что глобально нужно приложениям от сети: связности между точками
А и Б (ну иногда +В-Я) и изоляции от других приложений и пользователей.</p>
<div class="line-block">
<div class="line">И таким образом, наша задача в этой серии - выстроить систему,</div>
</div>
<p>поддерживающую актуальную конфигурацию всей сети, которая уже
декомпозируется на актуальную конфигурацию на каждом устройстве в
соответствии с его ролью и местоположением.
| Система управления сетью подразумевает, что для внесения изменений мы
обращаемся в неё, а она уже в свою очередь вычисляет нужное состояние
для каждого устройства и настраивает его.
| Таким образом мы минимизируем почти до нуля хождение в CLI руками -
любые изменения в настройках устройств или дизайне сети должны быть
формализованы и документированы - и только потом выкатываться на нужные
элементы сети.</p>
<blockquote><p>То есть, например, если мы решили, что с этого момента стоечные
коммутаторы в Казани должны анонсировать две сети вместо одной, мы</p>
<ol>
        <li><p>Сначала документируем изменения в системах</p>
</li>
        <li><p>Генерируем целевую конфигурацию всех устройств сети</p>
</li>
        <li><p>Запускаем программу обновления конфигурации сети, которая вычисляет, что
нужно удалить на каждом узле, что добавить, и приводит узлы к нужному
состоянию.</p>
</li>
    </ol><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">При</span> <span class="n">этом</span> <span class="n">руками</span> <span class="n">мы</span> <span class="n">вносим</span> <span class="n">изменения</span> <span class="n">только</span> <span class="n">на</span> <span class="n">первом</span> <span class="n">шаге</span><span class="o">.</span>
</pre></div>
</div>
</blockquote><h2><p>Тестирование конфигурации</p>
</h2><div class="line-block">
<div class="line">Известно, что 80% проблем случаются во время изменения конфигурации -</div>
</div>
<p>косвенное тому свидетельство - то, что в период новогодних каникул
обычно всё спокойно.
| Я лично был свидетелем десятков глобальных даунтаймов из-за ошибки
человека: неправильная команда, не в той ветке конфигурации выполнили,
забыли комьюнити, снесли MPLS глобально на маршрутизаторе, настроили
пять железок, а на шестой ошибку не заметили, закоммитили старые
изменения, сделанные другим человеком. Сценариев тьма тьмущая.</p>
<p>Автоматика нам позволит совершать меньше ошибок, но в большем масштабе.
Так можно окирпичить не одно устройство, а всю сеть разом.</p>
<div class="line-block">
<div class="line">Испокон веков наши деды проверяли правильность вносимых изменений</div>
</div>
<p>острым глазом, стальными яйцами и работоспособностью сети после их
выкатки.
| Те деды, чьи работы приводили к простою и катастрофическим убыткам,
оставляли меньше потомства и должны со временем вымереть, но эволюция
процесс медленный, и поэтому до сих пор не все предварительно проверяют
изменения в лаборатории.
| Однако на острие прогресса те, кто автоматизировал процесс
тестирования конфигурации, и дальнейшего её применения на сеть. Иными
словами - позаимствовал процедуру CI/CD (Continuous Integration,
Continuous Deployment) у разработчиков. В одной из частей мы рассмотрим
как реализовать это с помощью системы контроля версий, вероятно,
гитхаба.</p>
<blockquote><p>Как только вы свыкнитесь с мыслью о сетевом CI/CD, в одночасье метод
проверки конфигурации путём её применения на рабочую сеть покажется вам
раннесредневековым невежеством. Примерно как стучать молотком по
боеголовке.</p>
</blockquote><p>Органическим продолжением идей о системе управления сетью и CI/CD
становится полноценное версионирование конфигурации.</p>
<h2><p>Версионирование</p>
</h2><p>Мы будем считать, что при любых изменениях, даже самых незначительных,
даже на одном незаметном устройстве, вся сеть переходит из одного
состояния в другое. И мы всегда не выполняем команду на устройстве, мы
меняем состояние сети. Вот давайте эти состояния и будем называть
версиями?</p>
<p>Допустим, текущая версия - 1.0.0. Поменялся IP-адрес Loopback-интерфейса
на одном из ToR’ов? Это минорная версия - получит номер 1.0.1.
Пересмотрели политики импорта маршрутов в BGP - чуть посерьёзнее - уже
1.1.0 Решили избавиться от IGP и перейти только на BGP - это уже
радикальное изменение дизайна - 2.0.0.</p>
<p>При этом разные ДЦ могут иметь разные версии - сеть развивается,
ставится новое оборудование, где-то добавляются новые уровни спайнов,
где-то - нет, итд.</p>
<p>Про семантическое версионирование мы поговорим в отдельной статье.</p>
<p>Повторюсь - любое изменение (кроме отладочных команд) - это обновление
версии. О любых отклонениях от актуальной версии должны оповещаться
администраторы.</p>
<p>То же самое касается отката изменений - это не отмена последних команд,
это не rollback силами операционной системы устройства - это приведение
всей сети к новой (старой) версии.</p>
<h2><p>Мониторинг и самовосстановление сервисов</p>
</h2><p>Это самоочевидная задача в современных сетях выходит на новый уровень.
Зачастую у больших сервис-провайдеров практикуется подход, что упавший
сервис надо очень быстро добить и поднять новый, вместо того, чтобы
разбираться, что произошло. «Очень» означает, что со всех сторон нужно
обильно обмазаться мониторингами, которые в течение секунд обнаружат
малейшие отклонения от нормы. И здесь уже не достаточно привычных
метрик, вроде загрузки интерфейса или доступности узла. Недостаточно и
ручного слежения дежурного за ними. Для многих вещей вообще должен быть
Self-Healing - мониторинги зажглись красным и пошли сами подорожник
приложили, где болит.</p>
<p>И здесь мы тоже мониторим не только отдельные устройства, но и здоровье
сети целиком, причём как вайтбокс, что сравнительно понятно, так и
блэкбокс, что уже сложнее.</p>
<hr><p>Что нам понадобится для реализации таких амбициозных планов?</p>
<ul>
    <li><p>Иметь список всех устройств в сети, их расположение, роли, модели,
версии ПО.</p>
<blockquote>
<div><p>kazan-leaf-1.lmu.net, Kazan, leaf, Juniper QFX 5120, R18.3.</p>
</div></blockquote>
</li>
    <li><dl class="simple">
<dt>Иметь систему описания сетевых сервисов.</dt><dd><p>IGP, BGP, L2/3VPN, Policy, ACL, NTP, SSH.</p>
</dd>
</dl>
</li>
    <li><dl class="simple">
<dt>Уметь инициализировать устройство.</dt><dd><p>Hostname, Mgmt IP, Mgmt Route, Users, RSA-Keys, LLDP, NETCONF</p>
</dd>
</dl>
</li>
    <li><p>Настраивать устройство и приводить конфигурацию к нужной (в том числе
старой) версии.</p>
</li>
    <li><p>Тестировать конфигурацию</p>
</li>
    <li><p>Периодически проверять состояние всех устройств на предмет отхождения от
актуального и сообщать кому следует. ночью кто-то тихонько добавил
правило в ACL</p>
</li>
    <li><p>Следить за работоспособностью.</p>
</li>
</ul>
<hr></div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ADSM</a></h1>








<h3>Навигация</h3>
<p class="caption"><span class="caption-text">Содержание:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Часть 0. Планирование</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">0. Цели</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">0.ЦЕЛИ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Часть 0. Планирование</a><ul>
  <li><a href="index.html">0. Цели</a><ul>
      <li>Previous: <a href="index.html" title="предыдущая глава">0. Цели</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Искать" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, eucariot.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/0_planning/0_goals/goals.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>