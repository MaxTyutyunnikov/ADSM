<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Схема данных NetBox</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/epub.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="netbox">
<h1>Схема данных NetBox</h1>
<p>Две главные задачи, которые решает NetBox: управление адресным пространством и инвентаризация.
NetBox едва ли станет единственной системой инвентаризации в компании, скорее, это будет специфическая дополнительная система для инвентаризации именно сети, забирающая данные из основной.
Очевидно, в нашем случае для целей АДСМ будет только NetBox.</p>
<blockquote>
<div><p>К данному моменту бо́льшая часть начальных данных в NetBox уже внесена.
На этих данных я буду демонстрировать различные примеры работы через API.
Вы можете просто полазить и посмотреть: <a class="reference external" href="http://netbox.linkmeup.ru:45127">http://netbox.linkmeup.ru:45127</a>
И эти же данные понадобятся в дальнейшем, когда мы перейдём к автоматизации.</p>
</div></blockquote>
<dl>
<dt>В общих чертах схему данных можно увидеть по схеме БД в Postgres’е</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------+------------------------------------+-------+--------+
<span class="p">|</span><span class="w">        </span><span class="p">|</span><span class="w">               </span>List<span class="w"> </span>of<span class="w"> </span>relations<span class="w">    </span><span class="p">|</span><span class="w">       </span><span class="p">|</span><span class="w">        </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>Schema<span class="w"> </span><span class="p">|</span><span class="w">                </span>Name<span class="w">                </span><span class="p">|</span><span class="w"> </span>Type<span class="w">  </span><span class="p">|</span><span class="w"> </span>Owner<span class="w">  </span><span class="p">|</span>
+<span class="o">========</span>+<span class="o">====================================</span>+<span class="o">=======</span>+<span class="o">========</span>+
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_group<span class="w">                         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_group_permissions<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_permission<span class="w">                    </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_user<span class="w">                          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_user_groups<span class="w">                   </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>auth_user_user_permissions<span class="w">         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>circuits_circuit<span class="w">                   </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>circuits_circuittermination<span class="w">        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>circuits_circuittype<span class="w">               </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>circuits_provider<span class="w">                  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_cable<span class="w">                         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_consoleport<span class="w">                   </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_consoleporttemplate<span class="w">           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_consoleserverport<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_consoleserverporttemplate<span class="w">     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_device<span class="w">                        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_devicebay<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_devicebaytemplate<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_devicerole<span class="w">                    </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_devicetype<span class="w">                    </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_frontport<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_frontporttemplate<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_interface<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_interface_tagged_vlans<span class="w">        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_interfacetemplate<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_inventoryitem<span class="w">                 </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_manufacturer<span class="w">                  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_platform<span class="w">                      </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_powerfeed<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_poweroutlet<span class="w">                   </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_poweroutlettemplate<span class="w">           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_powerpanel<span class="w">                    </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_powerport<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_powerporttemplate<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_rack<span class="w">                          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_rackgroup<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_rackreservation<span class="w">               </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_rackrole<span class="w">                      </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_rearport<span class="w">                      </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_rearporttemplate<span class="w">              </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_region<span class="w">                        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_site<span class="w">                          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>dcim_virtualchassis<span class="w">                </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>django_admin_log<span class="w">                   </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>django_content_type<span class="w">                </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>django_migrations<span class="w">                  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>django_session<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext<span class="w">               </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_platforms<span class="w">     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_regions<span class="w">       </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_roles<span class="w">         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_sites<span class="w">         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_tags<span class="w">          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_tenant_groups<span class="w"> </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_configcontext_tenants<span class="w">       </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_customfield<span class="w">                 </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_customfield_obj_type<span class="w">        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_customfieldchoice<span class="w">           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_customfieldvalue<span class="w">            </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_customlink<span class="w">                  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_exporttemplate<span class="w">              </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_graph<span class="w">                       </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_imageattachment<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_objectchange<span class="w">                </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_reportresult<span class="w">                </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_tag<span class="w">                         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_taggeditem<span class="w">                  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_webhook<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>extras_webhook_obj_type<span class="w">            </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_aggregate<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_ipaddress<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_prefix<span class="w">                        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_rir<span class="w">                           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_role<span class="w">                          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_service<span class="w">                       </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_service_ipaddresses<span class="w">           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_vlan<span class="w">                          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_vlangroup<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>ipam_vrf<span class="w">                           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>secrets_secret<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>secrets_secretrole<span class="w">                 </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>secrets_secretrole_groups<span class="w">          </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>secrets_secretrole_users<span class="w">           </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>secrets_sessionkey<span class="w">                 </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>secrets_userkey<span class="w">                    </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>taggit_tag<span class="w">                         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>taggit_taggeditem<span class="w">                  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>tenancy_tenant<span class="w">                     </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>tenancy_tenantgroup<span class="w">                </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>users_token<span class="w">                        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>virtualization_cluster<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>virtualization_clustergroup<span class="w">        </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>virtualization_clustertype<span class="w">         </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>public<span class="w"> </span><span class="p">|</span><span class="w"> </span>virtualization_virtualmachine<span class="w">      </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>netbox<span class="w"> </span><span class="p">|</span>
+--------+------------------------------------+-------+--------+
</pre></div>
</div>
</dd>
</dl>
<p><a class="reference external" href="https://netbox.readthedocs.io/en/stable/#what-is-netbox">Функции NetBox</a><span class="link-target"> [https://netbox.readthedocs.io/en/stable/#what-is-netbox]</span>:</p>
<ul class="simple">
<li><p><strong>IP address management (IPAM)</strong> - IP-префиксы, адреса, VRF’ы и VLAN’ы</p></li>
<li><p><strong>Equipment racks</strong> - Стойки для оборудования, организованные по сайтам, группам и ролям</p></li>
<li><p><strong>Devices</strong> - Устройства, их модели, роли, комплектующие и расопложение</p></li>
<li><p><strong>Connections</strong> - Сетевые, консольные и силовые соединения между устройствами</p></li>
<li><p><strong>Virtualization</strong> - Виртуальные машины и вычислительные кластера</p></li>
<li><p><strong>Data circuits</strong> - Подключения к провайдерам</p></li>
<li><p><strong>Secrets</strong> - Зашифрованное хранилище учётных данных пользователей</p></li>
</ul>
<p>В этой статье я коснусь следующих вещей: DCIM - Data Center Infrastructure Management, IPAM - IP Address Management, Виртуализация, дополнительные приятные вещи.
Обо всём по порядку.</p>
<div class="section" id="dcim">
<h2>DCIM</h2>
<p>Самая важная часть - это, несомненно, какое оборудование у нас стоит и как оно друг к другу подключено. Но начинается всё с того, <strong>где</strong> оно стоит.</p>
<div class="section" id="regions-sites">
<h3>Регионы и сайты (regions/sites)</h3>
<p>В парадигме NetBox устройство устанавливается на сайт, сайт принадлежит региону, регионы могут быть вложены. При этом устройство не может быть установлено просто в регионе. Если такая необходимость есть, должен быть заведён отдельный сайт.</p>
<p>Для нашего случая это может (и будет) выглядеть так:</p>
<ul>
<li><p><a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/?region=ru">Россия</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/?region=ru]</span>: <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/msk/">Москва</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/msk/]</span>, <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/kzn/">Казань</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/kzn/]</span></p></li>
<li><p><a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/?region=sp">Испания</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/?region=sp]</span>: <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/bcn/">Барселона</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/bcn/]</span>, <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/mlg/">Малага</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/mlg/]</span></p></li>
<li><p><a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/?region=cn">Китай</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/?region=cn]</span>: <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/sha/">Шанхай</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/sha/]</span>, <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/sites/sia/">Сиань</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/sites/sia/]</span>.</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/sites.png" src="https://fs.linkmeup.ru/images/adsm/3/sites.png" style="width: 800px;" />
</div>
</div></blockquote>
</li>
</ul>
<p>Напоминаю где и как мы планировали нашу сеть: <a class="reference external" href="https://linkmeup.ru/blog/479.html">АДСМ2. Дизайн сети</a><span class="link-target"> [https://linkmeup.ru/blog/479.html]</span></p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/topology.png" src="https://fs.linkmeup.ru/images/adsm/3/topology.png" style="width: 700px;" />
</div>
<div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/sites_mlg.png" src="https://fs.linkmeup.ru/images/adsm/3/sites_mlg.png" style="width: 800px;" />
</div>
</div></blockquote>
<p>Давайте посмотрим, что позволяет API.
Вот так можно вывести список всех регионов:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/regions/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>Здесь и далее я буду приводить примеры curl и pynetbox без вывода результата.
<strong>Не забудьте</strong> слэш в конце URL - без него не заработает.
Как использовать pynetbox я рассказывал в статье про <a class="reference external" href="https://linkmeup.ru/blog/530.html#PYNETBOX">RESTful API</a><span class="link-target"> [https://linkmeup.ru/blog/530.html#PYNETBOX]</span>.</p>
</div></blockquote>
<p>Получить список сайтов:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/sites/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Список сайтов конкретного региона:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/sites/?region=ru&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s2">&quot;ru&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Обратите внимание, что поиск идёт не по полному имени, а по так называемому <a class="reference external" href="https://qna.habr.com/q/375615">slug</a><span class="link-target"> [https://qna.habr.com/q/375615]</span>.
<strong>Slug</strong> - это идентификатор, содержащий только безопасные символы: [0-9A-Za-z-_], который можно использовать в URL. Задаётся он при создании объекта, например, «bcn» вместо «Барселона».</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/nb_slug.png" src="https://fs.linkmeup.ru/images/adsm/3/nb_slug.png" style="width: 400px;" />
</div>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="id12">
<h3>Устройства</h3>
<p>Само устройство обладает какой-то <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/device-roles/">ролью</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/device-roles/]</span>, например, leaf, spine, edge, border.
Оно, очевидно, является какой-то <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/device-types/">моделью</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/device-types/]</span> какого-то <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/manufacturers/">вендора</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/manufacturers/]</span>.
Например, <a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/device-types/?manufacturer=arista">Arista</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/device-types/?manufacturer=arista]</span>.
Таким образом, сначала создаётся вендор, далее внутри него модели.
<a class="reference external" href="http://netbox.linkmeup.ru:45127/dcim/device-types/2/">Модель</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/dcim/device-types/2/]</span> характеризуется именем, набором сервисных интерфейсов, интерфейсом удалённого управления, консольным портом и набором модулей питания.</p>
<p>Помимо коммутаторов, маршрутизаторов и хостов, обладающих Ethernet-интерфейсами, можно создавать консольные сервера.</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/devices.png" src="https://fs.linkmeup.ru/images/adsm/3/devices.png" style="width: 800px;" />
</div>
<div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/device_mlg.png" src="https://fs.linkmeup.ru/images/adsm/3/device_mlg.png" style="width: 500px;" />
</div>
</div></blockquote>
<p>Получить список всех устройств:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Всех устройств конкретного сайта:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/?site=mlg&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nb.dcim.devices.filter<span class="o">(</span><span class="nv">site</span><span class="o">=</span><span class="s2">&quot;mlg&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Всех устройств определённой модели</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/?model=veos&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">device_type_id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Всех устройств определённой роли:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/?role=leaf&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;leaf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Устройство может быть в разных статусах: Active, Offline, Planned итд.
Все активные устройства:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/?status=active&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id17">
<h3>Интерфейсы</h3>
<p>NetBox поддерживает множество типов физических <a class="reference external" href="http://netbox.linkmeup.ru:45127/api/dcim/_choices/">интерфейсов</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/api/dcim/_choices/]</span> и LAG, однако все виртуальные, такие как Vlan/IRB и loopback объединены под одним типом - Virtual.
Каждый интерфейс привязан к какому-либо устройству.</p>
<p>Интерфейсы устройств могут быть подключены друг к другу. Это будет отображаться как в интерфейсе, так и в ответах API (атрибут connected_endpoint).</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/interfaces.png" src="https://fs.linkmeup.ru/images/adsm/3/interfaces.png" style="width: 800px;" />
</div>
</div></blockquote>
<p>Интерфейс может быть в различных режимах: Tagged или Access.
Соответственно, в него могут быть спущены с тегом или без VLAN’ы - данного сайта или глобальные.</p>
<p>Получить список всех интерфейсов устройства:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Получить список VLAN’ов конкретного интерфейса.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet7&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ethernet7&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">untagged_vlan</span><span class="o">.</span><span class="n">vid</span>
</pre></div>
</div>
<p>Обратите внимание, что тут я уже использую метод <strong>get</strong> вместо <strong>filter</strong>. Filter возвращает список, даже если результат - один единственный объект. Get - возвращает один объект или падает с ошибкой, если результатом запроса является список объектов.
Поэтому get следует использовать только тогда, когда вы абсолютно уверены, что результат будет в единственном экземпляре.
Ещё здесь же прямо после запроса я обращаюсь к атрибутам объекта. Строго говоря, это неправильно: если по запросу ничего не найдено, то pynetbox вернёт None, а у него нет атрибута «untagged_vlan».
И ещё обратите внимание, что не везде pynetbox ожидает slug, где-то и name.</p>
</div></blockquote>
<p>Выяснить к какому интерфейсу какого устройства подключен определённый интерфейс:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet1&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iface</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ethernet1&quot;</span><span class="p">)</span>
<span class="n">iface</span><span class="o">.</span><span class="n">connected_endpoint</span><span class="o">.</span><span class="n">device</span>
<span class="n">iface</span><span class="o">.</span><span class="n">connected_endpoint</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div></blockquote>
<p>Узнать имя интерфейса управления:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;mgmt_only=true&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">,</span> <span class="n">mgmt_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id19">
<h3>Консольные порты</h3>
<p>Консольные порты не являются интерфейсами, поэтому вынесены как отдельные эндпоинты.
Порты устройства можно связать с портами консольного сервера.</p>
<p>Выяснить к какому порту какого консольного сервера подключено конкретное устройство.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/console-ports/?device=mlg-leaf-0&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">console_ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</pre></div>
</div>
<p>Метод <strong>serialize</strong> в pynetbox позволяет преобразовать атрибуты экземпляра класса в словарь.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="ipam">
<h2>IPAM</h2>
<div class="section" id="vlan-vrf">
<h3>VLAN и VRF</h3>
<p>Могут быть привязаны к локации - полезно для VLAN.
При создании VRF можно указать, допускается ли пересечение адресного пространства с другими VRF.</p>
<p>Получить список всех VLAN:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/vlans/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">vlans</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Получить список всех VRF:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/vrfs/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">vrfs</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="ip">
<h3>IP-префиксы</h3>
<p>Имеют иерархическую структуру. Может принадлежать какому-либо VRF (если не принадлежит - то Global).</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/prefixes.png" src="https://fs.linkmeup.ru/images/adsm/3/prefixes.png" style="width: 800px;" />
</div>
</div></blockquote>
<p>В NetBox очень удобное визуальное представление свободных префиксов:</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/available_prefixes.png" src="https://fs.linkmeup.ru/images/adsm/3/available_prefixes.png" style="width: 800px;" />
</div>
</div></blockquote>
<p>Выделить можно просто кликом на зелёную строчку.</p>
<p>Может быть привязан к локации. Можно через API выделить следующий свободный под-префикс нужного размера или следующий свободный IP-адрес.
Галочка/параметр «Is a pool» определяет, будет ли при автоматическом выделении выделяться 0-й адрес из этого префикса, или начнётся с 1-го.</p>
<p>Получить список IP-префиксов сайта Малага c ролью Underlay и длиной 19:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/prefixes/?site=mlg&amp;role=underlay&amp;mask_length=19&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">prefixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="s2">&quot;mlg&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;underlay&quot;</span><span class="p">,</span> <span class="n">mask_length</span><span class="o">=</span><span class="s2">&quot;19&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Получить список свободных префиксов в регионе Россия c ролью Underlay:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span><span class="o">.</span><span class="n">available_prefixes</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Выделить следующий свободный префикс длиной в 24:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f&quot;</span><span class="w"> </span><span class="se">\</span>
-d<span class="w"> </span><span class="s2">&quot;{\&quot;prefix_length\&quot;: 24}&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span><span class="o">.</span><span class="n">available_prefixes</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s2">&quot;prefix_length&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">})</span>
</pre></div>
</div>
<p>Когда внутри одного объекта нам нужно выделить какой-то дочерний, используется метод POST и нужно указать ID родительского объекта - в данном случае - <strong>40</strong>. Его мы выяснили вызовом из предыдущего примера.
В случае pynetbox мы сначала (в предыдущем примере) сохранили результат в переменную <strong>prefix</strong>, а далее обратились к его атрибуту <strong>available_prefixes</strong> и методу <strong>create</strong>.
Этот пример у вас <strong>не сработает</strong>, поскольку токен с правом записи уже недействителен.</p>
</div></blockquote>
</div>
<div class="section" id="id20">
<h3>IP-адреса</h3>
<p>Если есть включающий этот адрес префикс, то будут его частью. Могут быть и сами по себе.
Могут принадлежать какому-либо VRF или быть в Global.
Могут быть привязаны к интерфейсу, а могут висеть в воздухе.
Можно выделить следующий свободный IP-адрес в префиксе.</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/ip_addresses.png" src="https://fs.linkmeup.ru/images/adsm/3/ip_addresses.png" style="width: 800px;" />
</div>
</div></blockquote>
<p>Чтобы сделать это, просто нужно кликнуть по зелёной строчке.</p>
<p>Получить список IP-адресов конкретного интерфейса:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?interface_id=8&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">ip_addresses</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">interface_id</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Или:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0&amp;interface=Ethernet1&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">ip_addresses</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&quot;Ethernet1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Получить список всех IP-адресов устройства:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">ip_addresses</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;mlg-leaf-0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Получить список доступных IP-адресов префикса:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">ipam</span><span class="o">.</span><span class="n">prefixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="s2">&quot;mlg&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;leaf-loopbacks&quot;</span><span class="p">)</span>
<span class="n">prefix</span><span class="o">.</span><span class="n">available_ips</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
</pre></div>
</div>
<p>Здесь снова нужно в URL указать ID префикса, из которого выделяем адрес - на сей раз это 28.</p>
</div></blockquote>
<p>Выделить следующий свободный IP-адрес в префиксе:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;accept: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
-H<span class="w"> </span><span class="s2">&quot;Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span><span class="o">.</span><span class="n">available_ips</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id21">
<h2>Виртуализация</h2>
<p>Мы же всё-таки боремся за звание современного ДЦ. Куда же без виртуализации.
NetBox не выглядит и не является местом, где стоит хранить информацию о виртуальных машинах (даже о необходимости хранения в нём физических машин можно порассуждать). Однако нам это может оказаться полезным, например, можно занести информация о Route Reflector’ах, о служебных машинах, таких как NTP, Syslog, S-Flow-серверах, о машинах-управляках.
ВМ обладает своим списком интерфейсов - они отличны от интерфейсов физических устройств и имеют свой отдельный Endpoint.</p>
<p>Так можно вывести список всех виртуальных машин:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/virtualization/virtual-machines/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">virtual_machines</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Так - всех интерфейсов всех ВМ:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/virtualization/interfaces/&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">virtualization</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Для ВМ нельзя указать конкретный гипервизор/физическую машину, на котором она запущена, но можно указать кластер. Хотя не всё так безнадёжно. Читаем дальше.</p>
</div>
<div class="section" id="id22">
<h2>Дополнительные приятные вещи</h2>
<p>Основная функциональность NetBox закрывает большинство задач многих пользователей, но не все. Всё-таки изначально продукт написан для решения задач конкретной компании. Однако он активно развивается и новые релизы выходят довольно <a class="reference external" href="https://github.com/netbox-community/netbox/releases">часто</a><span class="link-target"> [https://github.com/netbox-community/netbox/releases]</span>. Соответственно появляются и новые функции.
Так, например, с моей первой установки NetBox пару лет назад в нём появились теги, config contexts, webhooks, кэширование, supervisord сменился на systemd, внешние хранилища для файлов.</p>
<div class="section" id="custom-fields">
<h3>Custom fields</h3>
<p>Иногда хочется к какой-либо сущности добавить поле, в которое можно было бы поместить произвольные данные.
Например, указать номер договора поставки, по которому был приобретён коммутатор или имя физической машины, на которой запущена ВМ.
Тут на помощь и приходит custom fields - как раз такое поле с текстовым значением, которое можно добавить почти к любой сущности в NetBox.</p>
<p>Создаётся Custom fields в админской панели</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/nb_custom_fields.png" src="https://fs.linkmeup.ru/images/adsm/3/nb_custom_fields.png" style="width: 600px;" />
</div>
</div></blockquote>
<p>Вот так это выглядит при редактировании устройства, для которого был создан custom field:</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/nb_custom_field_edit.png" src="https://fs.linkmeup.ru/images/adsm/3/nb_custom_field_edit.png" style="width: 450px;" />
</div>
</div></blockquote>
<p>Запросить список устройств по значению custom_field</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/?cf_contract_number=0123456789&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nb</span><span class="o">.</span><span class="n">dcim</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">cf_contract_number</span><span class="o">=</span><span class="s2">&quot;0123456789&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="config-context">
<h3>Config Context</h3>
<p>Иногда хочется чего-то большего, чем неструктурированный текст. Тогда на помощь приходит <a class="reference external" href="http://netbox.linkmeup.ru:45127/extras/config-contexts/1/">Config Context</a><span class="link-target"> [http://netbox.linkmeup.ru:45127/extras/config-contexts/1/]</span>.
Это возможность ввести набор структурированных данных в формате JSON, который больше некуда поместить.
Это может быть, например, набор BGP communities или список Syslog-серверов.
Config Context может быть локальным - настроенным для конкретного объекта - или глобальным, когда он настраивается однажды, а затем распространяется на все объекты, удовлетворяющие определённым условиям (например, расположенные на одном сайте, или запущенные на одной платформе).</p>
<blockquote>
<div><div class="figure align-center">
<img alt="https://fs.linkmeup.ru/images/adsm/3/config_context.png" src="https://fs.linkmeup.ru/images/adsm/3/config_context.png" style="width: 800px;" />
</div>
</div></blockquote>
<p>Config Context автоматически добавляется к результатам запроса. При этом локальные и глобальные контексты сливаются в один.</p>
<p>Например, для устройства just a simple russian girl, для которого есть локальный контекст, в выводе будет ключ «config_context»:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://netbox.linkmeup.ru:45127/api/dcim/devices/?q=russian&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json; indent=4&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;config_context&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;syslog_servers&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1.1.1&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;2.2.2.2&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;ntp_servers&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;3.3.3.3&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id25">
<h3>Теги</h3>
<p>Про теги сложно сказать что-то новое. Они есть. Они удобны для добавления какого-либо признака. К примеру, можно пометить тегом «бяда» коммутаторы из партии, в которой сбоит память.</p>
</div>
<div class="section" id="webhooks">
<h3>Webhooks</h3>
<p>Незаменимая вещь, когда нужно, чтобы об изменениях в NetBox’е узнавали другие сервисы.
Например, при заведении нового коммутатора отправляется хука в систему автоматизации, которая запускает процесс настройки устройства и ввода в эксплуатацию.</p>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>